pipeline {
    agent any
	parameters {
    choice choices: ['Development', 'Certification', 'Staging', 'Production'], description: 'Please select the environment?', name: 'ENVIRONMENT'
}
    stages{
    stage("Are we good to deploy the Infra Provisioning?"){
        input{
           message "Should we deploy the TF Infra Project?"
        }
	    steps{
	      echo "Terraform project will begin"
	      echo "Terraform project build no is: ${BUILD_ID}"
	      echo "You've chosen environment is: ${ENVIRONMENT}"
	    }
	}
    stage('Cloning the Repository'){
        steps {
            echo 'Git cloning in progress..'
	        git branch: 'main', url: 'https://github.com/send2durai/ansible-notes.git'
        }
    }
    stage('Terraform Init'){
        steps {
		sh '''
                echo 'Terraform Init will begun..'
		mkdir iam_user
		cd iam_user
	        cp ../Iac_Scripts/Iam_user_creation/* .
		sleep 5
                terraform init
		'''
        }
    }
    stage('Terraform fmt'){
        steps {
            echo 'Terraform format...'
	        sh 'terraform fmt'
        }
    }
	stage('Terraform validate'){
           steps {
              echo 'Terraform validate...'
	      sh 'terraform validate'
            }
	}
	stage('Terraform apply'){
           steps {
              sh '''
	         echo "Terraform apply in progress"
	         terraform destroy --auto-approve
	      '''
        }
    }
   }
}

pipeline {
    agent any
    parameters {
       string defaultValue: 'P021473', description: 'Who is executing the Jenkins Job', name: 'EXECUTOR_PID'
       choice choices: ['DEV', 'CERT', 'STAGE', 'PROD'], description: 'Select the environment to deploy the resources', name: 'selectenv'
       choice choices: ['terraform apply --auto-approve', 'terraform destroy --auto-approve'], description: 'Please select what do you wanted to achieve it...', name: 'TF_ACTION'
    }
	stages{
	    stage("provisioning infra on dev environment"){
		    when{
			  expression{
			    params.selectenv == "DEV"
			   }
			}
			steps{
			   echo "Deploying into Development"
			   sh '''
			      pwd
				  cd Infrastructure_provision/IAM_USER/
				  pwd
				  ls -lrth
				  sleep 5
				  terraform init
				  terraform fmt
				  terraform plan
				  echo "Going to execute as: ${TF_ACTION}"
			  '''  
		         }
	        }
		stage("provisioning infra on cert environment"){
		    when{
			  expression{
			    params.selectenv == "CERT"
			   }
			}
			steps{
			   echo "Deploying into Certification"
		        }
	}
	stage("provisioning infra on staging environment"){
	    when{
		   expression{
		     params.selectenv == "STAGE"
			}
		   }
		steps{
			   echo "Deploying into staging"
			}
	}
	stage("provisioning infra on prod environment"){
	    when{
		   expression{
		     params.selectenv == "PROD"
			}
		}
		steps{
		    echo "Deploying into production"
		  }
	}
	//stage("Workspace CleanUp"){
		//steps{
		    //echo "Cleaning up the workspace in Jenkins"
			//cleanWs()
		 //}
	    //}
	}
}
